<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Панель администратора</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #2b2f5c 0%, #0b1023 40%, #050712 100%);
            min-height: 100vh;
            padding: 12px;
            color: #f5f5ff;
        }

        .topbar {
            width: 100%;
            max-width: 100%;
            margin: 0 auto 18px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, #14172b, #181b34);
            border-radius: 16px;
            padding: 10px 14px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.7);
        }

        .topbar-title { font-size: 16px; font-weight: 600; }

        .topbar-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 14px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.18);
            background: rgba(17, 22, 45, 0.9);
            color: #d9dcff;
            font-size: 13px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .btn:hover {
            background: rgba(32, 39, 82, 0.98);
            box-shadow: 0 4px 16px rgba(0,0,0,0.6);
        }

        .btn-danger {
            border-color: rgba(248,113,113,0.6);
            color: #fecaca;
        }

        .layout {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
            gap: 16px;
        }

        @media (max-width: 900px) {
            .layout { grid-template-columns: minmax(0, 1fr); }
        }

        .shell {
            background: radial-gradient(circle at top, rgba(255,255,255,0.04), rgba(0,0,0,0.7));
            border-radius: 24px;
            padding: 16px;
            box-shadow: 0 18px 60px rgba(0,0,0,0.8);
        }

        .inner {
            background: linear-gradient(145deg, #191c33, #14172b);
            border-radius: 18px;
            padding: 20px 18px 18px;
            border: 1px solid rgba(255,255,255,0.06);
        }

        h2 { font-size: 18px; margin-bottom: 12px; }

        .stats-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 14px;
        }

        .stat-pill {
            padding: 8px 12px;
            border-radius: 999px;
            background: rgba(9,12,28,0.9);
            border: 1px solid rgba(255,255,255,0.08);
            font-size: 13px;
        }

        .list {
            max-height: 420px;
            overflow-y: auto;
            padding-right: 4px;
        }

        .card {
            border-radius: 14px;
            background: rgba(9,12,28,0.9);
            border: 1px solid rgba(255,255,255,0.06);
            padding: 10px 12px;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .card-name { font-weight: 600; }

        .card-meta {
            font-size: 12px;
            color: #a7b0ff;
        }

        .card-body { margin-bottom: 6px; }

        .approve-form {
            margin-top: 4px;
            display: flex;
            gap: 6px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn-approve {
            padding: 6px 12px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg, #22c55e, #4ade80);
            color: #062814;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-reject {
            padding: 6px 12px;
            border-radius: 999px;
            border: none;
            background: linear-gradient(135deg,#f97373,#fb7185);
            color:#2b0606;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .members-simple {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 14px;
        }

        .member-line {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 12px;
            background: rgba(9,12,28,0.9);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .member-main {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .member-emoji { font-size: 20px; }

        .member-title {
            font-size: 12px;
            color: #ffd84b;
        }

        .member-actions {
            font-size: 12px;
            color:#a7b0ff;
            text-align:right;
        }

        .member-actions form {
            margin-top:4px;
        }

        .btn-small {
            padding:4px 8px;
            border-radius:999px;
            border:none;
            font-size:11px;
            cursor:pointer;
        }
    </style>
</head>
<body>
<div class="topbar">
    <div class="topbar-title">Админ-панель клуба</div>
    <div class="topbar-actions">
        <form method="POST" action="{{ url_for('clear_surveys') }}">
            <button type="submit" class="btn btn-danger">Очистить анкеты</button>
        </form>
        <button type="button" class="btn" onclick="showNextBirthday()">Ближайший ДР</button>
        <a href="{{ url_for('admin_stats') }}" class="btn">Статистика</a>
        <a href="{{ url_for('index_page') }}" class="btn">На сайт</a>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-danger">Выйти</a>
    </div>
</div>

<div class="layout">
    <!-- ЗАЯВКИ -->
    <div class="shell">
        <div class="inner">
            <h2>Заявки</h2>
            <div class="stats-row">
                <div class="stat-pill">Всего анкет: {{ total_surveys }}</div>
                <div class="stat-pill">Ожидает: {{ pending_surveys }}</div>
                <div class="stat-pill">Одобрено: {{ approved_surveys }}</div>
            </div>

            <div class="list">
                {% if not pending_list %}
                    <p style="font-size:13px; color:#a7b0ff;">Нет заявок в ожидании.</p>
                {% else %}
                    {% for s in pending_list %}
                    <div class="card">
                        <div class="card-header">
                            <div class="card-name">{{ s.name }}</div>
                            <div class="card-meta">{{ s.createdAt }}</div>
                        </div>
                        <div class="card-body">
                            {% if s.birthDate %}<div>Дата рождения: {{ s.birthDate }}</div>{% endif %}
                            {% if s.telegramUsername %}<div>Telegram: @{{ s.telegramUsername }}</div>{% endif %}
                            {% if s.familyStatus %}<div>Семейное положение: {{ s.familyStatus }}</div>{% endif %}
                            {% if s.children %}<div>Дети: {{ s.children }}</div>{% endif %}
                            {% if s.interests %}<div>Увлечения: {{ s.interests }}</div>{% endif %}
                            {% if s.topics %}<div>Темы: {{ s.topics }}</div>{% endif %}
                            {% if s.goals %}<div>Цель: {{ s.goals }}</div>{% endif %}
                            {% if s.source %}<div>Источник: {{ s.source }}</div>{% endif %}
                        </div>
                        <div class="approve-form">
                            <form method="POST" action="{{ url_for('approve_survey', survey_id=s.id) }}">
                                <button type="submit" class="btn-approve">Одобрить</button>
                            </form>
                            <form method="POST" action="{{ url_for('reject_survey', survey_id=s.id) }}">
                                <button type="submit" class="btn-reject">Отклонить</button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- УЧАСТНИЦЫ -->
    <div class="shell">
        <div class="inner">
            <h2>Участницы клуба</h2>
            <div class="stats-row">
                <div class="stat-pill">Всего участниц: {{ total_members }}</div>
            </div>

            <div class="members-simple">
                {% if not members_list %}
                    <p style="font-size:13px; color:#a7b0ff;">Пока нет участниц.</p>
                {% else %}
                    {% for m in members_list %}
                    <div class="member-line">
                        <div class="member-main">
                            <div class="member-emoji">{{ m.emoji }}</div>
                            <div>
                                <div>{{ m.name }}</div>
                                <div class="member-title">{{ m.title }}</div>
                            </div>
                        </div>
                        <div class="member-actions">
                            <div>{{ m.joinedAt }}</div>

                            <form method="POST"
                                  action="{{ url_for('update_title', member_id=m.id) }}"
                                  style="display:flex; gap:4px; margin-top:4px;">
                                <input name="title"
                                       type="text"
                                       value="{{ m.title }}"
                                       style="padding:4px 6px; border-radius:8px;
                                              border:1px solid rgba(255,255,255,0.15);
                                              background:rgba(9,12,28,0.9); color:#f5f5ff;
                                              font-size:11px; width:120px;">
                                <button type="submit"
                                        class="btn-small"
                                        style="background:linear-gradient(135deg,#22c55e,#4ade80); color:#062814;">
                                    Сохранить
                                </button>
                            </form>

                            <form method="POST"
                                  action="{{ url_for('remove_member', member_id=m.id) }}">
                                <button type="submit"
                                        class="btn-small"
                                        style="margin-top:4px;
                                               background:linear-gradient(135deg,#f97373,#fb7185);
                                               color:#2b0606;">
                                    Удалить
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
async function showNextBirthday() {
    try {
        const res = await fetch('/api/next_birthday');
        const data = await res.json();

        if (!data.hasBirthday) {
            alert('Нет участниц с указанной датой рождения.');
            return;
        }

        const m = data.member;
        const days = data.days;
        const msg = days === 0
            ? `Сегодня день рождения у ${m.name}!`
            : `Ближайший день рождения у ${m.name} через ${days} дн.`;
        alert(msg);
    } catch (e) {
        alert('Ошибка при расчёте ближайшего дня рождения.');
    }
}
</script>
</body>
</html>
